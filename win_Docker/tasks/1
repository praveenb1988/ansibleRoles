---
  - name: Checking if Docker Windows Service is already configured (to always ensure a fresh Windows Docker installation)
    win_service:
      name: docker
    register: docker_service_info
    ignore_errors: yes

  - name: Stop old Docker Windows Service if there 
    win_service:
      name: docker
      state: stopped
    when: docker_service_info.exists == True


  - name: Install (or upgrade) Docker via chocolatey
    win_chocolatey:
      name: docker
      state: latest

  - name: Start Docker as Windows Service
    win_service:
      name: docker
      state: started
  - name: Add remote "Administrator" user to "docker-users" group
    win_shell: net localgroup docker-users Administrator /add
    when: ResourceExists == false
    ignore_errors: yes


      # - name: Pull the small Windows Docker Base Image microsoft/nanoserver from hub.docker.com
    #win_shell: docker pull microsoft/nanoserver

    # - name: Pull the small Windows Docker Base Image microsoft/nanoserver with tag 1709 from hub.docker.com
    #win_shell: docker pull microsoft/nanoserver:1709
    # when: windows_version == "1709"

    # - name: Pull the small Windows Docker Base Image microsoft/nanoserver with tag 1803 from hub.docker.com
    #win_shell: docker pull microsoft/nanoserver:1803
    # when: windows_version == "1803"

#  - name: Get the second (but 10GB big) Windows Docker Base Image microsoft/windowsservercore from hub.docker.com (you may grab a coffee now...)
#    win_shell: docker pull microsoft/windowsservercore
